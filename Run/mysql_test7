
#SELECT  G.*, B.NAME AS  BRAND_NAME, T.NAME AS  TYPE_NAME, C.NAME AS  CAT_NAME FROM  ES_GOODS G LEFT JOIN  ES_GOODS_CAT C ON  G.CAT_ID=C.CAT_ID LEFT JOIN  ES_BRAND B ON  G.BRAND_ID=B.BRAND_ID AND  B.DISABLED=0 LEFT JOIN  ES_GOODS_TYPE T ON  G.TYPE_ID=T.TYPE_ID WHERE  G.DISABLED=0 AND(G.NAME  LIKE '%%' OR  G.SN LIKE '%%' )AND  MARKET_ENABLE!=2 ORDER BY  GOODS_ID DESC  LIMIT 0, 10;


#SELECT t.connecttime,IFNULL(t1.sqlCount,0) sqlCount,IFNULL(t1.avgTime,0) avgTime FROM (SELECT 0 AS connecttime UNION SELECT 1  UNION SELECT 2  UNION SELECT 3  UNION SELECT 4  UNION SELECT 5  UNION SELECT 6  UNION SELECT 7  UNION SELECT 8  UNION SELECT 9  UNION SELECT 10 UNION SELECT 11 UNION SELECT 12 UNION SELECT 13 UNION SELECT 14 UNION SELECT 15 UNION SELECT 16 UNION SELECT 17 UNION SELECT 18 UNION SELECT 19 UNION SELECT 20 UNION SELECT 21 UNION SELECT 22 UNION SELECT 23) t LEFT JOIN (SELECT connecttime,SUM(t.sqlCount) sqlCount,IFNULL(FLOOR(SUM(t.sqlCount * t.avgTime) / SUM(t.sqlCount)),0) avgTime FROM (SELECT HOUR(t.tlog_time) connecttime,SUM(t.sql_throughput) sqlCount,IFNULL(FLOOR(SUM(t.avg_cost_ms * t.sql_throughput) / SUM(t.sql_throughput)),0) avgTime FROM summary_performance_hour t WHERE t.dbfw_inst_id = 1 AND t.tlog_time >= '2020-09-18 00:00:00' AND t.tlog_time < '2020-09-18 10:00:00' AND t.database_id IN ( 1,10,11,12,13,14,15,16,17,18,19,2,20,21,22,23,24,25,26,27,28,29,3,30,31,32,33,34,35,36,4,5,6,7,8,9 ) GROUP BY connecttime union all SELECT HOUR(t.tlog_time) connecttime,SUM(t.sql_throughput) sqlCount,IFNULL(FLOOR(SUM(t.avg_cost_ms * t.sql_throughput) / SUM(t.sql_throughput)),0) avgTime FROM summary_performance t WHERE t.dbfw_inst_id = 1 AND t.tlog_time >= '2020-09-18 10:00:00' AND t.tlog_time < '2020-09-18 11:33:17' AND t.database_id IN ( 1,10,11,12,13,14,15,16,17,18,19,2,20,21,22,23,24,25,26,27,28,29,3,30,31,32,33,34,35,36,4,5,6,7,8,9 ) GROUP BY connecttime) t GROUP BY t.connecttime) t1 ON t.connecttime=t1.connecttime ;


#SELECT t.rule_type,t.rule_id,t1.rule_name,t1.state ruleState,sum(t.alarmsCount) alarmsCount FROM (SELECT t.database_id,t.rule_type,t.rule_id, SUM(t.alarms_throughput) alarmsCount FROM summary_alarms_hour t WHERE t.dbfw_inst_id = 1 AND t.time_start >= '2020-09-18 00:00:00' AND t.time_start < '2020-09-18 10:00:00' AND t.threat_level = 5 AND t.database_id IN (36) GROUP BY t.rule_type,t.rule_id union all SELECT t.database_id,t.rule_type,t.rule_id, SUM(t.alarms_throughput) alarmsCount FROM summary_alarms t WHERE t.dbfw_inst_id = 1 AND t.time_start >= '2020-09-18 10:00:00' AND t.time_start < '2020-09-18 11:33:14' AND t.threat_level = 5 AND t.database_id IN (36) GROUP BY t.rule_type,t.rule_id) t LEFT JOIN (SELECT DISTINCT t.database_id, 4 rule_type, t1.id rule_id, t1.`name` rule_name,t.state from ( select t.database_id, t.vpatch_ruleid,  CASE WHEN t.state = 1 AND t.isdelete != 1 THEN 'dbsec.lang.report.field.285' ELSE 'dbsec.lang.report.field.269' END state from ( select t.id, t.baseline_id, t.database_id, t.vpatch_ruleid, t.state, t.isdelete from vpatchstat_for_db_and_dbfw t order by t.baseline_id desc ) t group by  t.database_id, t.vpatch_ruleid ) t left join vpatch_rules t1 on t.vpatch_ruleid = t1.id UNION ALL SELECT t.database_id, t.rule_type, t.rule_id, t.rule_name, CASE WHEN t.state = 1 AND t.isdelete != 1 THEN 'dbsec.lang.report.field.285' ELSE 'dbsec.lang.report.field.269' END state FROM ( SELECT t.*, t1.rule_name, t1.rule_type FROM rule_db_relation t LEFT JOIN rule_main t1 ON t.rule_key_id = t1.id ORDER BY baseline_id DESC ) t GROUP BY t.database_id, t.rule_type, t.rule_id) t1 on t.database_id=t1.database_id and t.rule_type=t1.rule_type and t.rule_id=t1.rule_id GROUP BY t.rule_type,t.rule_id ORDER BY t.rule_type,t.rule_id;


#SELECT  COUNT(*)FROM(SELECT  G.GOODS_ID, G.SN, G.NAME, C.NAME  CNAME FROM(SELECT DISTINCT  GOODS_ID FROM  ES_PRODUCT P WHERE  P.PRODUCT_ID NOT  IN(SELECT  PRODUCTID FROM(SELECT  PRODUCTID, COUNT(*)COUNT FROM  ES_PRODUCT_STORE WHERE  ENABLE_STORE>5 GROUP BY  PRODUCTID)TEM WHERE  COUNT=(SELECT  COUNT(*)FROM  ES_DEPOT)))TEM, ES_GOODS G, ES_GOODS_CAT C WHERE  G.CAT_ID=C.CAT_ID AND  G.GOODS_ID=TEM.GOODS_ID AND  G.MARKET_ENABLE=1 AND  G.DISABLED=0)TEMP_TABLE;


